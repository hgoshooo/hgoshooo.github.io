<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Processor</title>
<style>
body { font-family: sans-serif; text-align: center; background: #111; color: #fff; }
input, button { margin: 10px; padding: 10px; font-size: 16px; }
video { margin-top: 20px; max-width: 90%; border: 2px solid #fff; border-radius: 10px; display:block; margin:auto; }
#status { margin-top: 20px; }
a { color: #0f0; display: block; margin-top: 10px; }
</style>
</head>
<body>

<h1>Local Video Processor</h1>

<input type="file" id="fileInput" accept="video/mp4">
<button id="processBtn" disabled>Process Video</button>
<div id="status">Loading FFmpeg…</div>

<video id="videoPlayer" controls></video>
<a id="downloadLink"></a>

<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.8/dist/ffmpeg.min.js"></script>
<script>
const { createFFmpeg, fetchFile } = FFmpeg;
const ffmpeg = createFFmpeg({ log: true });

const fileInput = document.getElementById("fileInput");
const processBtn = document.getElementById("processBtn");
const videoPlayer = document.getElementById("videoPlayer");
const downloadLink = document.getElementById("downloadLink");
const status = document.getElementById("status");

// Load FFmpeg first
(async () => {
    await ffmpeg.load();
    status.textContent = "FFmpeg ready! Select a video.";
    processBtn.disabled = false;
})();

processBtn.onclick = async () => {
    if (!fileInput.files.length) return alert("Select a file first!");
    const file = fileInput.files[0];

    status.textContent = "Processing… this may take a few seconds.";

    ffmpeg.FS('writeFile', 'input.mp4', await fetchFile(file));

    try {
        // Example FFmpeg command: scale video to 50%
        await ffmpeg.run('-i', 'input.mp4', '-vf', 'scale=iw/2:ih/2', 'output.mp4');
    } catch (err) {
        status.textContent = "Error processing video: " + err;
        return;
    }

    const data = ffmpeg.FS('readFile', 'output.mp4');
    const url = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));

    videoPlayer.src = url;
    videoPlayer.load();
    videoPlayer.play().catch(() => {});

    downloadLink.href = url;
    downloadLink.download = 'output.mp4';
    downloadLink.textContent = "Download Processed Video";

    status.textContent = "Done!";
};
</script>

</body>
</html>
